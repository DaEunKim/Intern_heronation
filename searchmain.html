<?
//include './sizeinfophp/connectdb.php';
include $_SERVER["DOCUMENT_ROOT"]."/sizeinfo/header.html";

if(isset($_COOKIE["userPKeyZeyo"])){
    $userID = $_COOKIE["userPKeyZeyo"];
}

$productCategoryTable = mysqli_query($conn,'SELECT * from Category where Category.State != -1;');

$allQuery = 'SELECT Product.CreatedDate as ProductCreatedDate,
Category.NameKR as CategoryName, Product.PKey as ProductPKey, Product.Name as ProductName
from Product
left join Category on Product.CategoryID = Category.PKey
order by Product.PKey desc;';

if ($result=mysqli_query($conn,$allQuery)){
  $rowcount=mysqli_num_rows($result);
}

?>
<style>
.bottom {
  text-align: center;
  padding: 40px;
}
.paging {
    display: inline-block;
}

.paging a {
  color: black;
  float: left;
  padding: 8px 16px;
  text-decoration: none;
  transition: background-color .3s;
  border: 1px solid #ddd;
  margin: 0 4px;
}

.paging a.active {
  background-color: #4CAF50;
  color: white;
  border: 1px solid #4CAF50;
}

.paging a:hover:not(.active) {background-color: #ddd;}
</style>

<script src="js_css/searchmain.js"></script>
<script>

$(document).ready(function(){

  var rowcount = '<?= $rowcount ?>'; //38
  makePageNum(rowcount);
  $(".pageNum").click(function(){


    $(".pageNum").css("background-color", "white");
    $(this).css("background-color", "red");

    pageNo = $(this).text()-1;
    $.ajax({
      type:"POST",
      url: './sizeinfophp/searchproductlist.php',
      data :{
        pageNo : pageNo
      },
      success : function(resData){
        var jsonData = JSON.parse(resData);
        var row = jsonData.length;
        makeTable(jsonData);
      },
      error : function(){
        alert('통신실패!!');
      }
    });
  });
  $(".pageNum:first").trigger('click');

});
function makePageNum(rowcount){
  var num;
  while(rowcount%10!=0){
    rowcount++;
    num = rowcount/10;
  }
  var text_number = 1;
  var page = ' ';
  while (1) {
    if(num==0){
      break;
    }
    page += "<a class='pageNum' href='#'>";
    page += text_number;
    page += "</a>";
    num--;
    text_number++;
  }
  page+= '<a href="#"> > </a><a href="#"> >> </a>';
  $(".paging").append(page);

}

function makeTable(jsonData) {
  $("#sizeInfoList_table").empty();
  var row = jsonData.length;
  var strTable = ' ';
  strTable += '<tr><td>선택</td><td>등록일</td><td>카테고리</td><td>제품번호</td><td>상품명</td><td>다운로드</td></tr>';


  for(var i = 0;i<row;i++){
    strTable += '<tr>';
    strTable += '<td><input type="checkbox" name="sizeInfoList_chk"></td>';
    strTable += '<td>';
    strTable += jsonData[i]['date'];
    strTable += '</td>';
    strTable += '<td>';
    strTable += jsonData[i]["CategoryName"];
    strTable += '</td>';

    strTable += '<td class="searchlist_productPKey">';
    strTable += jsonData[i]['ProductPKey'];
    strTable += '</td>';

    strTable += '<td class="updateProductInfo">';
    strTable += jsonData[i]['ProductName'];
    strTable += '</td>';
    strTable += '<td style="width:180px" id="download_button"><button type="submit" id="downloadImg">이미지파일</button><button type="submit" id="downloadHTML">HTML소스</button></td>'
    strTable += '</tr>';

  }
  $("#sizeInfoList_table").append(strTable);
}
</script>
<body>
<div id="myPage_main" class="mainDiv">
    <table id="myPage_mainTable" class="mainTable">
        <tr>
            <td id="myPage_left" class="mainLeft"><? include 'leftmenu.html'; ?>
                <input id="hPageKey" type="hidden" value=1>
            </td>
            <td id="myPage_right" class="mainRight">

                <div id="sizeInfoSearchList">
                    <div id="sizeInfoSearch">
                        <div id = "sizeInfoSearch_name"> 상품명: <input id="searchName" type="text" placeholder="Search..." <?if(isset($_GET['productName']))
                            echo 'value='.$_GET["productName"].''?>>
                        </div>
                        <div id = "sizeInfoSearch_category">상품 카테고리: <select id="sizeInfoSearch_selectItem">
                                <option value=0 selected>카테고리 선택</option>
                                <?
                                if(isset($_GET['categoryPKey'])){
                                    $selectedCategoryPKey = $_GET["categoryPKey"];
                                }
                                while($productCategoryRow = mysqli_fetch_array($productCategoryTable)){
                                    if(isset($selectedCategoryPKey) &&
                                    ($selectedCategoryPKey == $productCategoryRow['PKey'])){
                                        echo
                                        '<option value='.$productCategoryRow['PKey'].' selected>'.$productCategoryRow['NameKR'].'</option>';
                                    }
                                    else{
                                        echo
                                        '<option value='.$productCategoryRow['PKey'].'>'.$productCategoryRow['NameKR'].'</option>';
                                    }
                                }
                                ?>
                            </select>
                        </div>

                        <!-- <div id="sizeInfoSearch_date">등록일 <input id="searchStartDate" type="text"> ~ <input id="searchEndDate"  type="text">
                        </div> -->
                        <button type="submit" id="sizeInfoSearch_submit">검색</button>
                    </div>

                    <div id="sizeInfoList">
                        <button type="submit" id="sizeInfoList_delSelectedItem">삭제</button>
                        <button type="submit" id="sizeInfoList_instSizeInfo">신규 등록</button>
                        <table id="sizeInfoList_table">
                            <tr>
                                <td>선택</td>
                                <!-- <input type="checkbox" id="sizeInfoList_checkAll"> -->
                                <td>등록일</td>
                                <td>카테고리</td>
                                <td>제품번호</td>
                                <td>상품명</td>
                                <!-- <td>이미지 호스팅 URL</td> -->
                                <td>다운로드</td>
                            </tr>

                            <!-- <? include "./sizeinfophp/searchproductlist.php"; ?> -->
                        </table>
                    </div><!-- id:sizeInfoList end -->

                    <div class="bottom">
                      <div class="paging">
                        <a href="#"> << </a>
                        <a href="#"> < </a>
                      </div>
                    </div>

                </div><!-- id:sizeInfoSearchList end -->
            </td>
        </tr>
    </table>
</div>
<!-- </body>
</html> -->
